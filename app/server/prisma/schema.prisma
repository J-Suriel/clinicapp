// ----------------------
// Prisma Client generator
// ----------------------
generator client {
  provider = "prisma-client-js"
}

// ----------------------
// Database connection
// ----------------------
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ----------------------
// Enums
// ----------------------
enum Role {
  patient
  doctor
  admin
}

enum ApptStatus {
  scheduled
  completed
  canceled
  no_show
}

// ----------------------
// Models
// ----------------------

// Base user account used for auth
model AppUser {
  id           String   @id @default(uuid())
  email        String   @unique
  emailLower   String   @unique
  passwordHash String
  role         Role
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // one-to-one relations
  patient      Patient?
  doctor       Doctor?
}

// Patient profile linked 1–1 to AppUser
model Patient {
  id            String        @id @default(uuid())
  user          AppUser       @relation(fields: [userId], references: [id])
  userId        String        @unique

  fullName      String
  firstName     String?
  lastName      String?
  dob           DateTime?
  phone         String?
  insuranceCard String?
  createdAt     DateTime      @default(now())

  appointments  Appointment[]
}

// Doctor profile linked 1–1 to AppUser
model Doctor {
  id           String        @id @default(uuid())
  user         AppUser       @relation(fields: [userId], references: [id])
  userId       String        @unique

  fullName     String
  specialty    String?
  createdAt    DateTime      @default(now())

  appointments Appointment[]
}

// Appointment joins a Patient and a Doctor
model Appointment {
  id        String     @id @default(uuid())
  patient   Patient    @relation(fields: [patientId], references: [id])
  patientId String
  doctor    Doctor     @relation(fields: [doctorId], references: [id])
  doctorId  String

  startsAt  DateTime
  endsAt    DateTime
  status    ApptStatus
  reason    String?
  notes     String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@index([doctorId, startsAt])
  @@index([patientId, startsAt])
}
